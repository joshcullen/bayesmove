<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cluster observations • bayesmove</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cluster observations">
<meta property="og:description" content="bayesmove">
<meta property="og:image" content="http://joshcullen.github.io/bayesmove/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-151357058-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151357058-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesmove</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/joshcullen/bayesmove">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Cluster-observations_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cluster observations</h1>
            
            <h4 class="date">01 December 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/joshcullen/bayesmove/blob/master/vignettes/Cluster-observations.Rmd"><code>vignettes/Cluster-observations.Rmd</code></a></small>
      <div class="hidden name"><code>Cluster-observations.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Alternative to the model that first partitions the tracks into segments and then clusters these segments into behavioral states, observations can be directly clustered into behavioral states using a different model. This (mixture) model also incorporates the non-parametric Bayesian approach that analyzes binned data streams and uses a truncated stick-breaking prior to determine the optimal number of states, but does so in a single stage.</p>
<p>This modeling approach provides results similar to that of state-space and hidden Markov models, but does not assume any Markov property or include a mechanistic process that drives state transitions (e.g., a correlated random walk). This model simply clusters observations together based on the discretized data streams. Therefore, this method provides fast and flexible inference on behavioral states from telemetry data, where individuals are pooled together to make population-level estimates.</p>
</div>
<div id="empirical-example" class="section level2">
<h2 class="hasAnchor">
<a href="#empirical-example" class="anchor"></a>Empirical example</h2>
<p>This example will demonstrate the steps taken to prepare and analyze an empirical telemetry dataset for a single individual fisher <em>Martes pennanti</em> (<code>leroy</code>) available in the <code>move</code> package (LaPoint et al., 2013) for the estimation of observation-level behavioral states.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshcullen/bayesmove">bayesmove</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bartk.gitlab.io/move/">move</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="co"># Load data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">leroy</span><span class="op">)</span>

<span class="co"># Check data structure</span>
<span class="va">leroy</span>
<span class="co">#&gt; class       : Move </span>
<span class="co">#&gt; features    : 919 </span>
<span class="co">#&gt; extent      : -73.93067, -73.84366, 42.70898, 42.7687  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs         : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; variables   : 17</span>
<span class="co">#&gt; names       :      timestamp, eobs.battery.voltage, eobs.horizontal.accuracy.estimate, eobs.key.bin.checksum, eobs.speed.accuracy.estimate,    eobs.start.timestamp, eobs.status, eobs.temperature, eobs.type.of.fix, eobs.used.time.to.get.fix, ground.speed, heading, height.above.ellipsoid,      utm.easting,     utm.northing, ... </span>
<span class="co">#&gt; min values  :     1234354605,                 3596,                              3.07,               3258904,                         0.27, 2009-02-11 12:14:59.000,           A,               13,                3,                         4,         0.01,       0,                 -169.6, 587507.837877134, 4729143.16566605, ... </span>
<span class="co">#&gt; max values  : 1236158219.998,                 3666,                             97.02,            4291715164,                        33.04, 2009-03-04 09:15:01.000,           A,               35,                3,                       119,        31.71,  359.79,                    349, 594679.382402579, 4735720.47868847, ... </span>
<span class="co">#&gt; timestamps  : 2009-02-11 12:16:45 ... 2009-03-04 09:16:59 Time difference of 21 days  (start ... end, duration) </span>
<span class="co">#&gt; sensors     : gps </span>
<span class="co">#&gt; indiv. data : eobs.fix.battery.voltage, manually.marked.outlier, visible, sensor.type, individual.taxon.canonical.name, tag.local.identifier, individual.local.identifier, study.name, study.timezone </span>
<span class="co">#&gt; indiv. value: 0 NA true gps Martes pennanti 74 Leroy Urban fisher GPS tracking Eastern Standard Time </span>
<span class="co">#&gt; unused rec. : 1071 </span>
<span class="co">#&gt; study name  : Urban fisher GPS tracking </span>
<span class="co">#&gt; date created: 2020-06-24 08:04:52</span>
<span class="fu"><a href="https://bartk.gitlab.io/move/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">leroy</span><span class="op">)</span>; <span class="fu"><a href="https://bartk.gitlab.io/move/reference/lines.html">lines</a></span><span class="op">(</span><span class="va">leroy</span><span class="op">)</span></pre></div>
<p><img src="Cluster-observations_files/figure-html/load%20data-1.png" width="672"></p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># Convert from `Move` object to data frame</span>
<span class="va">leroy2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">leroy</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"leroy"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">study.local.timestamp</span><span class="op">)</span></pre></div>
<div id="prepare-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare-the-data" class="anchor"></a>Prepare the data</h3>
<p>To start off, we are going to calculate step lengths and turning angles from the data, as well as time intervals to determine the primary time step. Additionally, step length and turning angle distributions will be explored to determine how to bin these data streams. Observations will be filtered to only retain those recorded at the primary time step.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># Calculate step lengths (step), turning angles (angle), and time step (dt) </span>
<span class="va">leroy2</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_data.html">prep_data</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">leroy2</span>, coord.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"utm.easting"</span>,<span class="st">"utm.northing"</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>

<span class="co"># View distributions of data streams</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">leroy2</span><span class="op">$</span><span class="va">step</span><span class="op">)</span></pre></div>
<p><img src="Cluster-observations_files/figure-html/prep%20data-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">leroy2</span><span class="op">$</span><span class="va">angle</span><span class="op">)</span></pre></div>
<p><img src="Cluster-observations_files/figure-html/prep%20data-2.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit">

<span class="co"># Which dt is most common?</span>
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">leroy2</span><span class="op">$</span><span class="va">dt</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>  <span class="co">#15 min (900 s) is primary dt</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 901 900 902 896 898 903 907 909 890 904 906 910 892 905 874 894 925 927 865 876 </span>
<span class="co">#&gt;  27  24  21  20  20  16  15  15  14  14  14  14  13  13  12  12  12  12  11  11</span>


<span class="co">#Round times w/in 2 min of 15 min interval</span>
<span class="va">leroy3</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/round_track_time.html">round_track_time</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">leroy2</span>, id <span class="op">=</span> <span class="st">"id"</span>, int <span class="op">=</span> <span class="fl">900</span>, tol <span class="op">=</span> <span class="fl">120</span>, time.zone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">leroy3</span><span class="op">$</span><span class="va">dt</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  900 1828 1773 1802 1831 2710 1705 1708 1728 1739 1741 1748 1756 1759 1762 1777 </span>
<span class="co">#&gt;  826    3    2    2    2    2    1    1    1    1    1    1    1    1    1    1 </span>
<span class="co">#&gt; 1780 1781 1788 1793 </span>
<span class="co">#&gt;    1    1    1    1</span>


<span class="co"># Create list from data frame</span>
<span class="va">leroy.list</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/df_to_list.html">df_to_list</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">leroy3</span>, ind <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>

<span class="co"># Filter observations to keep only those recorded at 15 min (900 s)</span>
<span class="va">leroy.filt</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_time.html">filter_time</a></span><span class="op">(</span>dat.list <span class="op">=</span> <span class="va">leroy.list</span>, int <span class="op">=</span> <span class="fl">900</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="va">bind_rows</span></pre></div>
<p>Now, let’s bin step lengths and turning angles for analysis by the mixture model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># Define bin number and limits for turning angles</span>
<span class="va">angle.bin.lims</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="op">-</span><span class="va">pi</span>, to<span class="op">=</span><span class="va">pi</span>, by<span class="op">=</span><span class="va">pi</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span>  <span class="co">#8 bins</span>

<span class="co"># Define bin number and limits for step lengths</span>
<span class="va">dist.bin.lims</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">leroy.filt</span><span class="op">$</span><span class="va">step</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span>,<span class="fl">0.90</span>,<span class="fl">1</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>  <span class="co">#5 bins</span>


<span class="va">leroy.filt2</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/discrete_move_var.html">discrete_move_var</a></span><span class="op">(</span><span class="va">leroy.filt</span>, lims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">dist.bin.lims</span>, <span class="va">angle.bin.lims</span><span class="op">)</span>,
           varIn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"step"</span>,<span class="st">"angle"</span><span class="op">)</span>, varOut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SL"</span>,<span class="st">"TA"</span><span class="op">)</span><span class="op">)</span>


<span class="co"># Only retain id and discretized step length (SL) and turning angle (TA) columns</span>
<span class="va">leroy.sub</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">leroy.filt2</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">SL</span>, <span class="va">TA</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="run-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#run-the-model" class="anchor"></a>Run the model</h3>
<p>With the data streams in the correct format, we can now run the model to cluster observations into behavioral states.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="co"># Define model params</span>
<span class="va">alpha</span><span class="op">=</span><span class="fl">0.1</span>  <span class="co">#prior</span>
<span class="va">ngibbs</span><span class="op">=</span><span class="fl">1000</span>  <span class="co">#number of Gibbs sampler iterations</span>
<span class="va">nburn</span><span class="op">=</span><span class="va">ngibbs</span><span class="op">/</span><span class="fl">2</span>  <span class="co">#number of burn-in iterations</span>
<span class="va">nmaxclust</span><span class="op">=</span><span class="fl">7</span>  <span class="co">#number of maximum possible states (clusters) present</span>

<span class="co"># Run model</span>
<span class="va">dat.res</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster_obs.html">cluster_obs</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">leroy.sub</span>, alpha<span class="op">=</span><span class="va">alpha</span>, ngibbs<span class="op">=</span><span class="va">ngibbs</span>, nmaxclust<span class="op">=</span><span class="va">nmaxclust</span>,
                      nburn<span class="op">=</span><span class="va">nburn</span><span class="op">)</span>

<span class="co"># Inspect traceplot of log-likelihood</span>
<span class="fu"><a href="https://bartk.gitlab.io/move/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">dat.res</span><span class="op">$</span><span class="va">loglikel</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></pre></div>
<p><img src="Cluster-observations_files/figure-html/run%20model-1.png" width="672"></p>
</div>
<div id="visualize-the-results" class="section level3">
<h3 class="hasAnchor">
<a href="#visualize-the-results" class="anchor"></a>Visualize the results</h3>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># Determine the MAP estimate of the posterior</span>
<span class="va">MAP.iter</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_MAP_internal.html">get_MAP_internal</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat.res</span><span class="op">$</span><span class="va">loglikel</span>, nburn <span class="op">=</span> <span class="va">nburn</span><span class="op">)</span>

<span class="co"># Determine the likely number of behavioral states (i.e., what are the fewest states that account for &gt;= 90% of all observations?)</span>

<span class="va">theta</span><span class="op">&lt;-</span> <span class="va">dat.res</span><span class="op">$</span><span class="va">theta</span><span class="op">[</span><span class="va">MAP.iter</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>
<span class="va">theta</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">theta</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">theta</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="op">)</span>  <span class="co">#first 3 states likely (represent 97.6% of all assigned states)</span>
<span class="co">#&gt;         1         2         3         7         5         4         6 </span>
<span class="co">#&gt; 0.4654475 0.8016982 0.9760290 0.9886558 0.9942570 0.9972055 1.0000000</span>

<span class="co"># Store cluster order for plotting and behavioral state extraction</span>
<span class="va">ord</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>It appears that 3 behavioral states are likely based on the estimates from the <code>theta</code> matrix. To confirm that these states represent biologically interpretable movement patterns, we will also inspect the state-dependent distributions for all tested clusters/states.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co"># Extract bin estimates for each possible state from the `phi` matrix of the model results</span>
<span class="va">behav.res</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_behav_hist.html">get_behav_hist</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat.res</span>, nburn <span class="op">=</span> <span class="va">nburn</span>, ngibbs <span class="op">=</span> <span class="va">ngibbs</span>, nmaxclust <span class="op">=</span> <span class="va">nmaxclust</span>,
                           var.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Step Length"</span>,<span class="st">"Turning Angle"</span><span class="op">)</span>, ord <span class="op">=</span> <span class="va">ord</span>,
                           MAP.iter <span class="op">=</span> <span class="va">MAP.iter</span><span class="op">)</span>

<span class="co"># Plot state-dependent distributions </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">behav.res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bin</span>, y <span class="op">=</span> <span class="va">prop</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">behav</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"\nBin"</span>, y <span class="op">=</span> <span class="st">"Proportion\n"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,
        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
        axis.text.x.bottom <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
        strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridisLite/man/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"grey35"</span>,<span class="st">"grey35"</span>,
                               <span class="st">"grey35"</span>,<span class="st">"grey35"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.00</span>, <span class="fl">0.50</span>, <span class="fl">1.00</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">behav</span> <span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></pre></div>
<p><img src="Cluster-observations_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>Based on the resulting distributions, it appears that the first 3 states make biological sense and can potentially be classified as ‘Encamped’, ‘Exploratory’, and ‘Transit’ states. This is because state 1 (Encamped) exhibits low step lengths and high turning angles (near <span class="math inline">\(\pi\)</span> radians), state 2 (Exploratory) is characterized by a relatively uniform distribution of step lengths and turning angles, and state 3 (Transit) is characterized by large step lengths and low turning angles (near 0 radians). <strong>It should be noted that these broad classes of behavioral states likely include a variety of different behaviors that could not be discerned from these telemetry data alone.</strong></p>
<p>Next, we will assign these 3 states to the associated observations. For observations that were assigned to one of the other four states that will not be retained, they will be assigned a value of NA. Similarly, observations that were omitted from the analysis (that were not recorded at a 15 min time step) will also be labeled NA.</p>
</div>
<div id="mapping-behavioral-states-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-behavioral-states-estimates" class="anchor"></a>Mapping behavioral states estimates</h3>
<p>To map the state estimates, we will first need to extract the state assignments associated with the MAP estimate and then re-classify these values to match the modified order from the <code>theta</code> and <code>phi</code> matrices.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># Extract MAP estimate of behavioral states</span>
<span class="va">z</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat.res</span><span class="op">$</span><span class="va">z</span><span class="op">[[</span><span class="va">MAP.iter</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">&lt;-</span> <span class="va">ord</span>

<span class="co"># Relabel factor levels</span>
<span class="va">leroy.filt2</span><span class="op">$</span><span class="va">state</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Encamped"</span>,
                           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>, <span class="st">"Exploratory"</span>,
                                  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"Transit"</span>,
                                         <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Identify previously filtered observations and merge into final data frame</span>
<span class="va">ind</span><span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">leroy3</span><span class="op">)</span>, <span class="va">leroy.filt2</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
<span class="va">omit.df</span><span class="op">&lt;-</span> <span class="va">leroy3</span><span class="op">[</span><span class="va">ind</span>,<span class="op">]</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="va">ind</span>,
         time1 <span class="op">=</span> <span class="cn">NA</span>,
         SL <span class="op">=</span> <span class="cn">NA</span>,
         TA <span class="op">=</span> <span class="cn">NA</span>,
         state <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>


<span class="va">leroy.filt3</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">leroy.filt2</span>, <span class="va">omit.df</span><span class="op">)</span>
<span class="va">leroy.filt3</span><span class="op">&lt;-</span> <span class="va">leroy.filt3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">leroy.filt3</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>,<span class="op">]</span>


<span class="co"># Map behavioral states for Leroy</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">leroy.filt3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"gray60"</span>, size<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">leroy.filt3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill<span class="op">=</span><span class="va">state</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1.5</span>, pch<span class="op">=</span><span class="fl">21</span>, alpha<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">leroy.filt3</span> <span class="op">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"green"</span>, pch <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">3</span>, stroke <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">leroy.filt3</span> <span class="op">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">24</span>, size <span class="op">=</span> <span class="fl">3</span>, stroke <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span><span class="st">"Behavior"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Easting"</span>, y <span class="op">=</span> <span class="st">"Northing"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,
        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>label.theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
                             title.theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="Cluster-observations_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>In this map, the green circle represents the first location and the red triangle represents the final location. As with other models that estimate behavioral states, these results can be used for a variety of subsequent analyses, such as to determine behavior-specific habitat suitability (via RSFs/SSFs) or to calculate activity budgets.</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>LaPoint S, Gallery P, Wikelski M, Kays R. (2013). Animal behavior, cost-based corridor models, and real corridors. <em>Landscape Ecology</em>, 28(8), 1615–1630. <a href="http://dx.doi.org/10.1007/s10980-013-9910-0">doi:10.1007/s10980-013-9910-0</a>.</p>
<p>LaPoint S, Gallery P, Wikelski M, Kays R. (2013). Data from: Animal behavior, cost-based corridor models, and real corridors. <em>Movebank Data Repository</em>. <a href="http://dx.doi.org/10.5441/001/1.2tp2j43g">doi:10.5441/001/1.2tp2j43g</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua Cullen, Denis Valle.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
